<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 판매실적분석(품목) -->
<mapper namespace="com.hitejinro.snop.work.dao.M01030DaoMapper">

	
	<!-- 헤더 조회 -->
	<select id="searchHeader" parameterType="map" resultType="map">
	
	<if test='month != null and !month.equals("12")'>
		SELECT /* com.hitejinro.snop.work.dao.M01030DaoMapper.searchHeader */ 
			 'COL' || YYYYMMDD AS COL_ID 
		     , SUBSTR(YYYYMMDD, 0, 4) AS YEAR_ID
			 , SUBSTR(YYYYMMDD, 5, 2) AS MONTH_ID
			 , SUBSTR(YYYYMMDD, -2)   AS COL_SEQ
		     , CASE WHEN SUBSTR(YYYYMMDD, -2) = '01' THEN '경영목표'
		            WHEN SUBSTR(YYYYMMDD, -2) = '02' THEN '판매계획'
		            WHEN SUBSTR(YYYYMMDD, -2) = '03' THEN '판매실적'
		            WHEN SUBSTR(YYYYMMDD, -2) = '04' THEN '달성률'
		            WHEN SUBSTR(YYYYMMDD, -2) = '05' THEN '판매구성비'
		            WHEN SUBSTR(YYYYMMDD, -2) = '06' THEN '전년동기'
		            WHEN SUBSTR(YYYYMMDD, -2) = '07' THEN '전년대비증감'
		            WHEN SUBSTR(YYYYMMDD, -2) = '08' THEN '증감률'
		            WHEN SUBSTR(YYYYMMDD, -2) = '09' THEN '목표대비차이'
		            WHEN SUBSTR(YYYYMMDD, -2) = '10' THEN '달성률'
		       END COL_DESC
		     , CASE WHEN SUBSTR(YYYYMMDD, -2) = '01' THEN '당월(' || #{year, jdbcType=VARCHAR} || '년' || TO_NUMBER(SUBSTR(YYYYMMDD, 5, 2)) || '월' ||  ')'
		            ELSE '' 
		       END COL_HRNK_DESC
		     , DECODE(SUBSTR(YYYYMMDD, -2), '01', 10, 1) AS HEADER_COL_SPAN
		     , DECODE(SUBSTR(YYYYMMDD, -2), '04', 'Float', '05', 'Float', '08', 'Float', '10', 'Float', 'Int') AS COL_TYPE
		     , 0 AS VISIBLE
		  FROM SCMU.W_SOP_VW_CALENDAR_M
		 WHERE YYYYMM BETWEEN TO_CHAR(TO_NUMBER(#{year, jdbcType=VARCHAR}) - 1) || <if test='!month.equals("09") and !month.equals("10") and !month.equals("11")'>'0' || </if> TO_CHAR(TO_NUMBER(#{month, jdbcType=VARCHAR}) + 1)
		 				  AND TO_CHAR(TO_NUMBER(#{year, jdbcType=VARCHAR}) - 1) || '12' 
		   AND SUBSTR(YYYYMMDD, -2) <![CDATA[ < ]]> 11
		 UNION ALL
	</if>
	
		SELECT 'COL' || YYYY || '00' || SUBSTR(YYYYMMDD, -2) AS COL_ID
			 , SUBSTR(YYYYMMDD, 0, 4) AS YEAR_ID
			 , '00' AS MONTH_ID
			 , SUBSTR(YYYYMMDD, -2) AS COL_SEQ
		     , CASE WHEN SUBSTR(YYYYMMDD, -2) = '01' THEN '경영목표'
		            WHEN SUBSTR(YYYYMMDD, -2) = '02' THEN '판매계획'
		            WHEN SUBSTR(YYYYMMDD, -2) = '03' THEN '판매실적'
		            WHEN SUBSTR(YYYYMMDD, -2) = '04' THEN '달성률'
		            WHEN SUBSTR(YYYYMMDD, -2) = '05' THEN '판매구성비'
		            WHEN SUBSTR(YYYYMMDD, -2) = '06' THEN '전년동기'
		            WHEN SUBSTR(YYYYMMDD, -2) = '07' THEN '전년대비증감'
		            WHEN SUBSTR(YYYYMMDD, -2) = '08' THEN '증감률'
		            WHEN SUBSTR(YYYYMMDD, -2) = '09' THEN '목표대비차이'
		            WHEN SUBSTR(YYYYMMDD, -2) = '10' THEN '달성률'
		       END COL_DESC
		     , CASE WHEN SUBSTR(YYYYMMDD, -2) = '01' THEN '누계(' || #{year, jdbcType=VARCHAR} || '년' || '1' || '월' || ' ~ ' || #{year, jdbcType=VARCHAR} || '년' || TO_NUMBER(#{month, jdbcType=VARCHAR}) || '월' || ')'
		            ELSE '' 
		       END COL_HRNK_DESC
		     , DECODE(SUBSTR(YYYYMMDD, -2), '01', 10, 1) AS HEADER_COL_SPAN
		     , DECODE(SUBSTR(YYYYMMDD, -2), '04', 'Float', '05', 'Float', '08', 'Float', '10', 'Float', 'Int') AS COL_TYPE
		     , 1 AS VISIBLE
		  FROM SCMU.W_SOP_VW_CALENDAR_M  
		 WHERE YYYYMM = #{fromYYYYMM, jdbcType=VARCHAR}
		   AND SUBSTR(YYYYMMDD, -2) <![CDATA[ < ]]> 11
		 UNION ALL
		SELECT 'COL' || YYYYMMDD AS COL_ID
			 , SUBSTR(YYYYMMDD, 0, 4) AS YEAR_ID
			 , SUBSTR(YYYYMMDD, 5, 2) AS MONTH_ID
			 , SUBSTR(YYYYMMDD, -2)   AS COL_SEQ
		     , CASE WHEN SUBSTR(YYYYMMDD, -2) = '01' THEN '경영목표'
		            WHEN SUBSTR(YYYYMMDD, -2) = '02' THEN '판매계획'
		            WHEN SUBSTR(YYYYMMDD, -2) = '03' THEN '판매실적'
		            WHEN SUBSTR(YYYYMMDD, -2) = '04' THEN '달성률'
		            WHEN SUBSTR(YYYYMMDD, -2) = '05' THEN '판매구성비'
		            WHEN SUBSTR(YYYYMMDD, -2) = '06' THEN '전년동기'
		            WHEN SUBSTR(YYYYMMDD, -2) = '07' THEN '전년대비증감'
		            WHEN SUBSTR(YYYYMMDD, -2) = '08' THEN '증감률'
		            WHEN SUBSTR(YYYYMMDD, -2) = '09' THEN '목표대비차이'
		            WHEN SUBSTR(YYYYMMDD, -2) = '10' THEN '달성률'
		       END COL_DESC
		     , CASE WHEN SUBSTR(YYYYMMDD, -2) = '01' THEN '당월(' || #{year, jdbcType=VARCHAR} || '년' || TO_NUMBER(SUBSTR(YYYYMMDD, 5, 2)) || '월' ||  ')'
		            ELSE '' 
		       END COL_HRNK_DESC
		     , DECODE(SUBSTR(YYYYMMDD, -2), '01', 10, 1) AS HEADER_COL_SPAN
		     , DECODE(SUBSTR(YYYYMMDD, -2), '04', 'Float', '05', 'Float', '08', 'Float', '10', 'Float', 'Int') AS COL_TYPE
		     , 1 AS VISIBLE
		  FROM SCMU.W_SOP_VW_CALENDAR_M
		 WHERE YYYYMM BETWEEN #{fromYYYYMM, jdbcType=VARCHAR} AND #{toYYYYMM, jdbcType=VARCHAR}
		   AND SUBSTR(YYYYMMDD, -2) <![CDATA[ < ]]> 11
		 ORDER BY COL_ID

	</select>

	<!-- 조회 -->
	<select id="searchBody" parameterType="map" resultType="map">
	WITH SITE_TBL AS (/* com.hitejinro.snop.work.dao.M01030DaoMapper.searchBody */      -- 조회조건 중 조직콤보로 필터링 된 사업부
            SELECT SITE_CODE
                 , LIQUOR_CODE 
                 , BUSINESS_CODE
              FROM EDW.W_CM_TB_OM_DEPT_M 
             WHERE LIQUOR_CODE IN ('10', '20') 
               AND CUSTOMER_CATEGORY IN ('E', 'W', 'S', 'N', 'M', 'P', 'H', 'O') 
               AND TERRITORY_CODE NOT IN ('1006475','2079209') 
               AND TERRITORY_CODE IS NOT NULL 
               AND DEPARTMENT_CODE IS NOT NULL 
               AND PART_CODE IS NOT NULL 
               AND SALESREP_NUMBER IS NOT NULL
               AND OU_CODE = 'HJ0'
			   <if test='liquorCode != null and !liquorCode.equals("!ALL")'>
	           AND LIQUOR_CODE = #{liquorCode, jdbcType=VARCHAR}
	           </if>
	           <if test='accountNumber != null and !accountNumber.equals("!ALL")'>
	           AND ACCOUNT_NUMBER = #{accountNumber, jdbcType=VARCHAR}
	           </if>
	           <if test='territoryCode != null and !territoryCode.equals("!ALL")'>
	           AND TERRITORY_CODE = #{territoryCode, jdbcType=VARCHAR}
	           </if>
	           <if test='departmentCode != null and !departmentCode.equals("!ALL")'>
	           AND DEPARTMENT_CODE = #{departmentCode, jdbcType=VARCHAR}
	           </if>
	           <if test='partCode != null and !partCode.equals("!ALL")'>
	           AND PART_CODE = #{partCode, jdbcType=VARCHAR}
	           </if>
	           <if test='salesrepNumber != null and !salesrepNumber.equals("!ALL")'>
	           AND SALESREP_NUMBER = #{salesrepNumber, jdbcType=VARCHAR}
	           </if>
    )
    , ITEM_TBL AS (
            SELECT ITEM_CODE
                 , LIQUOR_CODE
                 , BUSINESS_CODE
                 , UOM_CONVERSION_VALUE 
              FROM EDW.W_CM_TB_FG_ITEM_M 
             WHERE LIQUOR_CODE IN ('10', '20')
               AND BUSINESS_CODE IN ('1', '2')
               AND ITEM_TYPE = 'FG'
               AND BRAND_CODE != '27'
	       	   <if test='liquorCode != null and !liquorCode.equals("!ALL")'>
	           AND B.LIQUOR_CODE = #{liquorCode, jdbcType=VARCHAR}
	           </if>  
	       	   <if test='segment2 != null and !segment2.equals("!ALL")'>
	           AND B.SEGMENT2 = #{segment2, jdbcType=VARCHAR}
	           </if>
	           <if test='segment3 != null and !segment3.equals("!ALL")'>
	           AND B.SEGMENT3 = #{segment3, jdbcType=VARCHAR}
	           </if>
	           <if test='mainFlag != null and !mainFlag.equals("!ALL")'>
	           AND B.MAIN_FLAG = #{mainFlag, jdbcType=VARCHAR}
	           </if>
    ) 
    , SALES_TBL AS (                                                                -- 월별, 사업별  당월 및 년 누계 판매량
            SELECT A.SALES_YYYYMM
                 , A.LIQUOR_CODE
                 <if test='uomYn != null and uomYn.equals("N")'>
                 , SUM(A.SALES_QTY_CD_ACCU) AS SALES_QTY_CD_ACCU_SUM 
                 , SUM(A.SALES_QTY_CD)      AS SALES_QTY_CD_SUM
                 </if>
                 <if test='uomYn != null and uomYn.equals("Y")'>
                 , SUM(A.CONV_SALES_QTY_CD_ACCU) AS SALES_QTY_CD_ACCU_SUM 
                 , SUM(A.CONV_SALES_QTY_CD)      AS SALES_QTY_CD_SUM
                 </if>
              FROM EDW.M_OM_TB_SALE_ITEM_MONTH_F    A
                 , ITEM_TBL                         B
                 , SITE_TBL                         C 
             WHERE A.OU_CODE = 'HJ0' 
               AND A.SALES_YYYYMM LIKE #{year, jdbcType=VARCHAR} || '%'
               AND A.LIQUOR_CODE IN ('10', '20')
               AND A.BUSINESS_CODE IN ('1', '2')
               AND A.ITEM_CODE = B.ITEM_CODE
               AND A.LIQUOR_CODE = B.LIQUOR_CODE
               AND A.BUSINESS_CODE = B.BUSINESS_CODE
               AND A.SITE_CODE = C.SITE_CODE
               AND A.LIQUOR_CODE = C.LIQUOR_CODE
               AND A.BUSINESS_CODE = C.BUSINESS_CODE
             GROUP BY A.SALES_YYYYMM, A.LIQUOR_CODE
    ) 
    , SALES_PLAN_TBL AS (                                                           -- 월, 사이트, 아이템, 사업 별 판매목표
            SELECT A.PERIOD_YYYYMM_CODE AS SALES_YYYYMM
                 , A.SITE_CODE
                 , A.ITEM_CODE
                 , A.LIQUOR_CODE
                 <if test='uomYn != null and uomYn.equals("N")'>
                 , A.SALES_PLAN_QTY
                 </if>
                 <if test='uomYn != null and uomYn.equals("Y")'>
                 , SALES_PLAN_QTY * UOM_CONVERSION_VALUE AS SALES_PLAN_QTY
                 </if>
              FROM W_OM_TB_SALE_RESULT_MM_F A
                 , ITEM_TBL                 B
                 , SITE_TBL                 C 
             WHERE 1 = 1
		       AND A.PERIOD_YYYYMM_CODE BETWEEN TO_CHAR(TO_NUMBER(#{year, jdbcType=VARCHAR}) - 1) || <if test='!month.equals("09") and !month.equals("10") and !month.equals("11")'>'0' || </if> TO_CHAR(TO_NUMBER(#{month, jdbcType=VARCHAR}) + 1)
											AND #{toYYYYMM, jdbcType=VARCHAR}
               AND A.LIQUOR_CODE IN ('10', '20')
               AND A.ITEM_CODE = B.ITEM_CODE
               AND A.LIQUOR_CODE = B.LIQUOR_CODE
               AND A.SITE_CODE = C.SITE_CODE
               AND A.LIQUOR_CODE = C.LIQUOR_CODE
    )
    , UNION_TBL AS (
            SELECT A.SALES_YYYYMM
                 , (SELECT MAX(SALES_YYYYMM) 
                 	  FROM EDW.M_OM_TB_SALE_ITEM_MONTH_F 
                 	 WHERE SALES_YYYYMM <![CDATA[ <= ]]> #{toYYYYMM, jdbcType=VARCHAR}
                 ) AS MAX_SALES_YYYYMM
                 , A.ITEM_CODE
                 , MAX(A.SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
                 , MAX(A.SALES_QTY_CD_SUM) AS SALES_QTY_CD_SUM
                 , SUM(NVL(A.PLAN_QTY_CM_ACCU, 0)) AS PLAN_QTY_CM_ACCU                                                                                          -- 년당월목표누계판매량 (경영목표)
                 , SUM(NVL(A.SALES_QTY_CD_ACCU, 0)) AS SALES_QTY_CD_ACCU                                                                                        -- 년누계판매량 (판매실적)
                 , SUM(NVL(A.SALES_QTY_BYM_ACCU, 0)) AS SALES_QTY_BYM_ACCU                                                                                      -- 전년동월누계판매량 (전년동기)
                 , SUM(NVL(A.SALES_VARIATION_BYY_ACCU, 0)) AS SALES_VARIATION_BYY_ACCU                                                                          -- (전년대비증감)
                 , SUM(NVL(A.DIFF_PER_PLAN_ACCU, 0)) AS DIFF_PER_PLAN_ACCU                                                                                      -- (목표대비차이)

                 , SUM(NVL(A.PLAN_QTY, 0)) AS PLAN_QTY                                                                                                          -- 당월목표량(경영목표)
                 , SUM(NVL(A.SALES_PLAN_QTY, 0)) AS SALES_PLAN_QTY                                                                                              -- (판매계획)
                 , SUM(NVL(A.SALES_QTY_CD, 0)) AS SALES_QTY_CD                                                                                                  -- 당월판매량(판매실적)
                 , SUM(NVL(A.SALES_QTY_BYM, 0)) AS SALES_QTY_BYM                                                                                                -- 전년동월판매량(전년동기)
                 , SUM(NVL(A.SALES_VARIATION_BYY, 0)) AS SALES_VARIATION_BYY                                                                                    -- (전년대비증감)
                 , SUM(NVL(A.DIFF_PER_PLAN, 0)) AS DIFF_PER_PLAN                                                                                                -- (목표대비차이)
              FROM (
                    -- PLAN
                    SELECT A.SALES_YYYYMM
                         , A.LIQUOR_CODE
                         , A.SITE_CODE
                         , A.ITEM_CODE
                         , MAX(C.SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
                         , MAX(C.SALES_QTY_CD_SUM) AS SALES_QTY_CD_SUM
                         , NULL AS PLAN_QTY_CM_ACCU                                                                                        -- 년당월목표누계판매량 (경영목표)
                         , NULL AS SALES_QTY_CD_ACCU                                                                                      -- 년누계판매량 (판매실적)
                         , NULL AS SALES_QTY_BYM_ACCU                                                                                    -- 전년동월누계판매량 (전년동기)
                         , NULL AS SALES_VARIATION_BYY_ACCU                                                          -- (전년대비증감)
                         , NULL AS DIFF_PER_PLAN_ACCU                                                             -- (목표대비차이)
                         , NULL AS PLAN_QTY                                                                                                        -- 당월목표량(경영목표)
                         , SUM(SALES_PLAN_QTY) AS SALES_PLAN_QTY                                                                                            -- (판매계획)
                         , NULL AS SALES_QTY_CD                                                                                                -- 당월판매량(판매실적)
                         , NULL AS SALES_QTY_BYM                                                                                              -- 전년동월판매량(전년동기)
                         , NULL AS SALES_VARIATION_BYY                                                                    -- (전년대비증감)
                         , NULL AS DIFF_PER_PLAN                                                                               -- (목표대비차이)
                      FROM SALES_PLAN_TBL A
                         , SALES_TBL C
                     WHERE 1 = 1
                       AND A.SALES_YYYYMM = C.SALES_YYYYMM
                       AND A.LIQUOR_CODE = C.LIQUOR_CODE
                     GROUP BY A.SALES_YYYYMM, A.LIQUOR_CODE, A.ITEM_CODE, A.SITE_CODE
                     UNION ALL
                    -- DATA
                    SELECT A.SALES_YYYYMM
                         , A.LIQUOR_CODE
                         , A.SITE_CODE
                         , A.ITEM_CODE
                         , MAX(C.SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
                         , MAX(C.SALES_QTY_CD_SUM) AS SALES_QTY_CD_SUM

		        	     <if test='uomYn != null and uomYn.equals("N")'>
		                 -- 단순
		                 , SUM(A.PLAN_QTY_CM_ACCU) AS PLAN_QTY_CM_ACCU                                                                                        -- 년당월목표누계판매량 (경영목표)
		                 , SUM(A.SALES_QTY_CD_ACCU) AS SALES_QTY_CD_ACCU                                                                                      -- 년누계판매량 (판매실적)
		                 , SUM(A.SALES_QTY_BYM_ACCU) AS SALES_QTY_BYM_ACCU                                                                                    -- 전년동월누계판매량 (전년동기)
		                 , SUM(A.SALES_QTY_CD_ACCU) - SUM(A.SALES_QTY_BYM_ACCU) AS SALES_VARIATION_BYY_ACCU                                                   -- (전년대비증감)
		                 , SUM(A.PLAN_QTY_CM_ACCU) - SUM(A.SALES_QTY_CD_ACCU) AS DIFF_PER_PLAN_ACCU                                                           -- (목표대비차이)
		                 
		                 , SUM(A.PLAN_QTY) AS PLAN_QTY                                                                                                        -- 당월목표량(경영목표)
		                 , NULL AS SALES_PLAN_QTY																							  				  -- (판매계획)
		                 , SUM(A.SALES_QTY_CD) AS SALES_QTY_CD                                                                                                -- 당월판매량(판매실적)
		                 , SUM(A.SALES_QTY_BYM) AS SALES_QTY_BYM                                                                                              -- 전년동월판매량(전년동기)
		                 , SUM(A.SALES_QTY_CD) - SUM(A.SALES_QTY_BYM) AS SALES_VARIATION_BYY                                                                  -- (전년대비증감)
		                 , SUM(A.PLAN_QTY) - SUM(A.SALES_QTY_CD) AS DIFF_PER_PLAN                                                                             -- (목표대비차이)
		    	         </if>
		    	         
			             <if test='uomYn != null and uomYn.equals("Y")'>
		                 -- 환산
	                     , SUM(A.CONV_PLAN_QTY_CM_ACCU) AS PLAN_QTY_CM_ACCU                                                                                   -- 년당월목표누계환산판매량 (경영목표)
	                     , SUM(A.CONV_SALES_QTY_CD_ACCU) AS SALES_QTY_CD_ACCU                                                                                 -- 년누계환산판매량 (판매실적)
	                     , SUM(A.CONV_SALES_QTY_BYM_ACCU) AS SALES_QTY_BYM_ACCU                                                                               -- 전년동월누계환산판매량 (전년동기)
	                     , SUM(A.CONV_SALES_QTY_CD_ACCU) - SUM(A.CONV_SALES_QTY_BYM) AS SALES_VARIATION_BYY_ACCU                                              -- (전년대비증감)
	                     , SUM(A.CONV_PLAN_QTY_CM_ACCU) - SUM(CONV_SALES_QTY_CD_ACCU) AS DIFF_PER_PLAN_ACCU                                                   -- (목표대비차이)
	                     
	                     , SUM(A.CONV_PLAN_QTY) AS PLAN_QTY                                                                                                   -- 당월환산목표량(경영목표)
	                     , NULL AS SALES_PLAN_QTY																						  					  -- (판매계획)
	                     , SUM(A.CONV_SALES_QTY_CD) AS SALES_QTY_CD                                                                                           -- 당월환산판매량(판매실적)
	                     , SUM(A.CONV_SALES_QTY_BYM) AS SALES_QTY_BYM                                                                                         -- 전년동월환산판매량(전년동기)
	                     , SUM(A.CONV_SALES_QTY_CD) - SUM(A.CONV_SALES_QTY_BYM) AS SALES_VARIATION_BYY                                                        -- (전년대비증감)
	                     , SUM(A.CONV_PLAN_QTY) - SUM(A.CONV_SALES_QTY_CD) AS DIFF_PER_PLAN                                                                   -- (목표대비차이)
			             </if>

                      FROM EDW.M_OM_TB_SALE_ITEM_MONTH_F A 
                         , SITE_TBL B
                         , SALES_TBL C
                         , ITEM_TBL D
                     WHERE 1 = 1
                       AND A.OU_CODE = 'HJ0'
                       AND A.SALES_YYYYMM BETWEEN TO_CHAR(TO_NUMBER(#{year, jdbcType=VARCHAR}) - 1) || <if test='!month.equals("09") and !month.equals("10") and !month.equals("11")'>'0' || </if> TO_CHAR(TO_NUMBER(#{month, jdbcType=VARCHAR}) + 1) 
	               						  AND #{toYYYYMM, jdbcType=VARCHAR}
                       AND A.LIQUOR_CODE IN ('10', '20')
                       AND A.BUSINESS_CODE IN ('1', '2')
                       AND A.SITE_CODE = B.SITE_CODE
                       AND A.BUSINESS_CODE = B.BUSINESS_CODE
                       AND A.LIQUOR_CODE = B.LIQUOR_CODE
                       AND A.SALES_YYYYMM = C.SALES_YYYYMM
                       AND A.LIQUOR_CODE = C.LIQUOR_CODE
                       AND A.ITEM_CODE = D.ITEM_CODE
                       AND A.BUSINESS_CODE = D.BUSINESS_CODE
                       AND A.LIQUOR_CODE = D.LIQUOR_CODE
                     GROUP BY A.SALES_YYYYMM, A.LIQUOR_CODE, A.ITEM_CODE, A.SITE_CODE
                 ) A
             GROUP BY A.ITEM_CODE, A.SALES_YYYYMM
    )
	, TBL AS (
	    SELECT CASE WHEN C.LVL = 1 THEN 'LI' || A.LIQUOR_CODE
	                WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE
	                WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE
	                WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE
	                WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE
	                WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE || '|' || A.ITEM_CODE
	           END              AS PK_PATH
	         , CASE WHEN C.LVL = 1 THEN 'NULL'
	                WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE 
	                WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE 
	                WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE 
	                WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE 
	                WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE 
	           END              AS HRNK_PK_PATH 
	         , CASE WHEN C.LVL = 1 THEN A.LIQUOR_CODE
	                WHEN C.LVL = 2 THEN A.BRAND_SORT_ORDER
	                WHEN C.LVL = 3 THEN A.USAGE_SORT_ORDER
	                WHEN C.LVL = 4 THEN A.VESSEL_SORT_ORDER
	                WHEN C.LVL = 5 THEN A.VOLUME_SORT_ORDER || A.VOLUME_VALUE
	                WHEN C.LVL = 6 THEN A.ITEM_CODE
	           END              AS SORT_ORDER
	         , CASE WHEN C.LVL = 1 THEN DECODE(A.LIQUOR_CODE, '10', '맥주', '20', '소주')
	                WHEN C.LVL = 2 THEN A.BRAND_NAME
	                WHEN C.LVL = 3 THEN A.USAGE_NAME
	                WHEN C.LVL = 4 THEN A.VESSEL_SORT
	                WHEN C.LVL = 5 THEN A.VOLUME_VALUE
	                WHEN C.LVL = 6 THEN A.DESCRIPTION
	           END              AS DESCRIPTION
	         , MAX(SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
	         , MAX(SALES_QTY_CD_SUM)      AS SALES_QTY_CD_SUM
	         
	<foreach open="" collection="TREEGRID_HEADER" index="index" item="item" separator="" close="">
		<if test='item.MONTH_ID != null and item.MONTH_ID == "00"'>
	        <choose>
		       	<when test='item.COL_SEQ != null and item.COL_SEQ == "01"'>
	         , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, PLAN_QTY_CM_ACCU, 0))         AS ${item.COL_ID}                                                     	-- 년당월목표누계판매량 (경영목표)	
	         	</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "02"'>
	         , SUM(SALES_PLAN_QTY) AS ${item.COL_ID}																														-- 년 누계(판매계획)
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "03"'>
	         , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0))        AS ${item.COL_ID}                                                    	-- 년누계판매량 (판매실적)
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "04"'>
			 , ROUND(DECODE(SUM(SALES_PLAN_QTY), 0, 0
			 			  , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) / SUM(SALES_PLAN_QTY))
			 	   , 4) AS ${item.COL_ID}																																	-- (계획 대비 달성률) 실적 / 계획

				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "05"'>
			 , ROUND(SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) / MAX(SALES_QTY_CD_ACCU_SUM), 4) AS ${item.COL_ID}                           -- (판매구성비)
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "06"'>
	         , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0))       AS ${item.COL_ID}                                                   	-- 전년동월누계판매량 (전년동기)
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "07"'>
	         , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_VARIATION_BYY_ACCU, 0)) AS ${item.COL_ID}                                             			-- (전년대비증감)
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "08"'>
			 , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0)), 0, 0
			 			  , (SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) - SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0))) 
			 			  / SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0)))
			 	   , 4) AS ${item.COL_ID}      																																-- (증감률)	         	
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "09"'>
	         , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, DIFF_PER_PLAN_ACCU, 0))       AS ${item.COL_ID}													 	-- (목표대비차이)
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "10"'>
			 , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, PLAN_QTY_CM_ACCU, 0)), 0, 0
			 			  , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) / SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, PLAN_QTY_CM_ACCU, 0)))
			 	   , 4) AS ${item.COL_ID}																																	-- (목표 대비 달성률) 실적 / 목표
				</when>
	        </choose>
		</if>
	         
		<if test='item.MONTH_ID != null and item.MONTH_ID != "00"'>
			<choose>
		       	<when test='item.COL_SEQ != null and item.COL_SEQ == "01"'>
	         , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, PLAN_QTY, 0)) AS ${item.COL_ID}                                      -- 당월목표량(경영목표)
		       	</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "02"'>
	         , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_PLAN_QTY, 0)) AS ${item.COL_ID}								-- 당월 (판매계획)
				</when>
		       	<when test='item.COL_SEQ != null and item.COL_SEQ == "03"'>
	         , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_CD, 0)) AS ${item.COL_ID}                                  -- 당월판매량(판매실적)
	         	</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "04"'>
			 , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_PLAN_QTY, 0)), 0, 0
			 			  , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_PLAN_QTY, 0)))
			 	   , 4) AS ${item.COL_ID}																																	-- (계획 대비 달성률) 실적 / 계획
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "05"'>
			 , ROUND(SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS ${item.COL_ID}     -- (판매구성비)
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "06"'>
	         , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_BYM, 0)) AS ${item.COL_ID}                                 -- 전년동월판매량(전년동기)
	         	</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "07"'>
	         , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_CD, 0)) 
	         - SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_BYM, 0)) AS ${item.COL_ID}   								-- (전년대비증감)
	         	</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "08"'>
			 , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_BYM, 0)), 0, 0
			 			  , (SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_BYM, 0))) 
			 			  / SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_BYM, 0)))
			 	   , 4) AS ${item.COL_ID}      																																-- (증감률)	         	
				</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "09"'>
	         , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, PLAN_QTY, 0)) 
	         - SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_CD, 0)) AS ${item.COL_ID}              					-- (목표대비차이)
	         	</when>
	         	<when test='item.COL_SEQ != null and item.COL_SEQ == "10"'>
			 , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, PLAN_QTY, 0)), 0, 0
			 			  , SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, #{item.YEAR_ID, jdbcType=VARCHAR}||#{item.MONTH_ID, jdbcType=VARCHAR}, PLAN_QTY, 0)))
			 	   , 4) AS ${item.COL_ID}																																	-- (목표 대비 달성률) 실적 / 목표
				</when>
		    </choose>	         
		</if>	 
	</foreach>
          FROM UNION_TBL B
    INNER JOIN EDW.W_CM_TB_FG_ITEM_M A
            ON A.ITEM_CODE = B.ITEM_CODE
    CROSS JOIN (
                    SELECT 1 AS LVL FROM DUAL UNION ALL
                    SELECT 2 AS LVL FROM DUAL UNION ALL
                    SELECT 3 AS LVL FROM DUAL UNION ALL
                    SELECT 4 AS LVL FROM DUAL UNION ALL
                    SELECT 5 AS LVL FROM DUAL UNION ALL
                    SELECT 6 AS LVL FROM DUAL
               )                         C
         WHERE 1 = 1
         GROUP BY 
               CASE WHEN C.LVL = 1 THEN 'LI' || A.LIQUOR_CODE
                    WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE
                    WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE
                    WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE
                    WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE || '|' || A.ITEM_CODE
               END              
             , CASE WHEN C.LVL = 1 THEN 'NULL'
                    WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE 
                    WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE 
                    WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE 
                    WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE 
                    WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE 
               END              
             , CASE WHEN C.LVL = 1 THEN A.LIQUOR_CODE
                    WHEN C.LVL = 2 THEN A.BRAND_SORT_ORDER
                    WHEN C.LVL = 3 THEN A.USAGE_SORT_ORDER
                    WHEN C.LVL = 4 THEN A.VESSEL_SORT_ORDER
                    WHEN C.LVL = 5 THEN A.VOLUME_SORT_ORDER || A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN A.ITEM_CODE
               END              
             , CASE WHEN C.LVL = 1 THEN DECODE(A.LIQUOR_CODE, '10', '맥주', '20', '소주')
                    WHEN C.LVL = 2 THEN A.BRAND_NAME
                    WHEN C.LVL = 3 THEN A.USAGE_NAME
                    WHEN C.LVL = 4 THEN A.VESSEL_SORT
                    WHEN C.LVL = 5 THEN A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN A.DESCRIPTION
               END             
    )
	    SELECT LEVEL AS DEPTH
	         , DESCRIPTION
	         , SORT_ORDER
	         , PK_PATH
	         , HRNK_PK_PATH
	         , CONNECT_BY_ISLEAF IS_LEAF
			<foreach open="" collection="TREEGRID_HEADER" index="index" item="item" separator="" close="">
	    	 , ${item.COL_ID}
			</foreach>
	      FROM TBL A
	     START WITH HRNK_PK_PATH = 'NULL'
	   CONNECT BY NOCYCLE PRIOR PK_PATH = HRNK_PK_PATH
	     ORDER SIBLINGS BY SORT_ORDER   
	</select>

	<select id="getTerritoryCombo" parameterType="map" resultType="map">
		SELECT DISTINCT TERRITORY_CODE AS CODE
		     , TERRITORY_NAME AS NAME
		     , TERRITORY_SORT_NUMBER
		  FROM EDW.W_CM_TB_OM_DEPT_M
		 WHERE TERRITORY_CODE IS NOT NULL
		   AND DEPARTMENT_CODE IS NOT NULL
		   AND PART_CODE IS NOT NULL
		   AND SALESREP_NUMBER IS NOT NULL
		   AND LIQUOR_CODE IN ('10', '20')
		   AND CUSTOMER_CATEGORY IN ('E', 'W', 'S', 'N', 'M', 'P', 'H', 'O')
		   AND TERRITORY_CODE NOT IN ('1006475','2079209')
		 ORDER BY TERRITORY_SORT_NUMBER, TERRITORY_CODE
	</select>
	
	<select id="getDepartmentCombo" parameterType="map" resultType="map">
		SELECT DISTINCT DEPARTMENT_CODE AS CODE
		     , DEPT_NAME AS NAME
		     , DEPT_SORT_NUMBER
		  FROM EDW.W_CM_TB_OM_DEPT_M
		 WHERE 1 = 1
		   AND TERRITORY_CODE IS NOT NULL
		   AND DEPARTMENT_CODE IS NOT NULL
		   AND PART_CODE IS NOT NULL
		   AND SALESREP_NUMBER IS NOT NULL
		   AND LIQUOR_CODE IN ('10', '20')
		   AND CUSTOMER_CATEGORY IN ('E', 'W', 'S', 'N', 'M', 'P', 'H', 'O')
		   AND TERRITORY_CODE NOT IN ('1006475','2079209')
		<if test="territoryCode != null and territoryCode != '!ALL'">
	       AND TERRITORY_CODE = #{territoryCode, jdbcType=VARCHAR}
		</if>
		 ORDER BY DEPT_SORT_NUMBER, DEPARTMENT_CODE
	</select>
	
	<select id="getPartCombo" parameterType="map" resultType="map">
		SELECT *
		  FROM ( 
			SELECT DISTINCT NVL(PART_CODE, '----') AS CODE
			     , NVL(PART_NAME, '----') AS NAME
			     , DECODE(PART_CODE, NULL, '000000', PART_SORT_NUMBER) AS PART_SORT_NUMBER
			  FROM EDW.W_CM_TB_OM_DEPT_M
			 WHERE 1 = 1
			   AND TERRITORY_CODE IS NOT NULL
			   AND DEPARTMENT_CODE IS NOT NULL
			   AND PART_CODE IS NOT NULL
			   AND SALESREP_NUMBER IS NOT NULL
			   AND LIQUOR_CODE IN ('10', '20')
			   AND CUSTOMER_CATEGORY IN ('E', 'W', 'S', 'N', 'M', 'P', 'H', 'O')
			   AND TERRITORY_CODE NOT IN ('1006475','2079209')
			<if test="departmentCode != null and departmentCode != '!ALL'">
		       AND DEPARTMENT_CODE = #{departmentCode, jdbcType=VARCHAR}
			</if>
			 )
		 ORDER BY PART_SORT_NUMBER, NVL(CODE, '----')
	</select>
	
	<select id="getSalesrepCombo" parameterType="map" resultType="map">
		SELECT DISTINCT SALESREP_NUMBER AS CODE
		     , SALESREP_NAME AS NAME
		     , SALESREP_SORT_NUMBER
		  FROM EDW.W_CM_TB_OM_DEPT_M
		 WHERE 1 = 1
		   AND TERRITORY_CODE IS NOT NULL
		   AND DEPARTMENT_CODE IS NOT NULL
		   AND PART_CODE IS NOT NULL
		   AND SALESREP_NUMBER IS NOT NULL
		   AND LIQUOR_CODE IN ('10', '20')
		   AND CUSTOMER_CATEGORY IN ('E', 'W', 'S', 'N', 'M', 'P', 'H', 'O')
		   AND TERRITORY_CODE NOT IN ('1006475','2079209')
		<if test="departmentCode != null and departmentCode != '!ALL'">
	       AND DEPARTMENT_CODE = #{departmentCode, jdbcType=VARCHAR}
		</if>
		<if test="partCode != null and partCode != '!ALL' and partCode != '----'">
	       AND PART_CODE = #{partCode, jdbcType=VARCHAR}
		</if>
		<if test="partCode != null and partCode != '!ALL' and partCode == '----'">
		   AND PART_CODE IS NULL
		</if>
		 ORDER BY SALESREP_SORT_NUMBER, SALESREP_NUMBER
	</select>
		
	<select id="getAccountCombo" parameterType="map" resultType="map">
		SELECT DISTINCT ACCOUNT_NUMBER AS CODE
		     , CUSTOMER_SHORT_NAME AS NAME
		     , CUSTOMER_SORT_NUMBER
		  FROM EDW.W_CM_TB_OM_DEPT_M
		 WHERE 1 = 1
		   AND TERRITORY_CODE IS NOT NULL
		   AND DEPARTMENT_CODE IS NOT NULL
		   AND PART_CODE IS NOT NULL
		   AND SALESREP_NUMBER IS NOT NULL
		   AND LIQUOR_CODE IN ('10', '20')
		   AND CUSTOMER_CATEGORY IN ('E', 'W', 'S', 'N', 'M', 'P', 'H', 'O')
		   AND TERRITORY_CODE NOT IN ('1006475','2079209')
		<if test="departmentCode != null and departmentCode != '!ALL'">
	       AND DEPARTMENT_CODE = #{departmentCode, jdbcType=VARCHAR}
		</if>
		<if test="partCode != null and partCode != '!ALL' and partCode != '----'">
	       AND PART_CODE = #{partCode, jdbcType=VARCHAR}
		</if>
		<if test="partCode != null and partCode != '!ALL' and partCode == '----'">
		   AND PART_CODE IS NULL
		</if>
		<if test="salesrepNumber != null and salesrepNumber != '!ALL'">
	       AND SALESREP_NUMBER = #{salesrepNumber, jdbcType=VARCHAR}
		</if>
		 ORDER BY CUSTOMER_SORT_NUMBER, ACCOUNT_NUMBER
	</select>
	
	<select id="getSegment2Combo" parameterType="map" resultType="map">
        SELECT DISTINCT SEGMENT2 AS CODE
             , SEGMENT2 AS NAME 
          FROM EDW.W_CM_TB_FG_ITEM_M
         WHERE 1 = 1
           AND LIQUOR_CODE IN ('10', '20') 
           AND ITEM_TYPE = 'FG'
           AND BRAND_CODE != '27'
           AND ITEM_STATUS = 'Active'
           AND BUSINESS_CODE IN ('1', '2')
         ORDER BY (DECODE(SEGMENT2, '맥주류', 0, '소주류', 1, '기타주류', 2, '기재주', 3, 4))
	</select>
	
	<select id="getSegment3Combo" parameterType="map" resultType="map">
        SELECT DISTINCT SEGMENT3 AS CODE
        	 , SEGMENT3 AS NAME 
          FROM EDW.W_CM_TB_FG_ITEM_M
         WHERE 1 = 1
		   AND LIQUOR_CODE IN ('10', '20') 
		   AND ITEM_TYPE = 'FG'
		   AND BRAND_CODE != '27'
		   AND ITEM_STATUS = 'Active'
		   AND BUSINESS_CODE IN ('1', '2') 
        <if test="segment2 != null and segment2 != '!ALL'">
	       AND SEGMENT2 = #{segment2, jdbcType=VARCHAR}
		</if>
	</select>
	
    <select id="getMagamYmd" resultType="String">
		SELECT MAGAM_YMD
		  FROM EDW.GEIS_MAGAM
		 WHERE SCRN_ID = 'GEISM0500R'
		   AND CO_CODE = 'HJ0'
    </select>
	
	
	
	<select id="unionQuery">

	WITH SITE_TBL AS (/* com.hitejinro.snop.work.dao.M01030DaoMapper.searchBody */      -- 조회조건 중 조직콤보로 필터링 된 사업부
            SELECT SITE_CODE
                 , LIQUOR_CODE 
                 , BUSINESS_CODE
              FROM EDW.W_CM_TB_OM_DEPT_M 
             WHERE LIQUOR_CODE IN ('10', '20') 
               AND CUSTOMER_CATEGORY IN ('E', 'W', 'S', 'N', 'M', 'P', 'H', 'O') 
               AND TERRITORY_CODE NOT IN ('1006475','2079209') 
               AND TERRITORY_CODE IS NOT NULL 
               AND DEPARTMENT_CODE IS NOT NULL 
               AND PART_CODE IS NOT NULL 
               AND SALESREP_NUMBER IS NOT NULL
               AND OU_CODE = 'HJ0'
    )
    , ITEM_TBL AS (
            SELECT ITEM_CODE
                 , LIQUOR_CODE
                 , BUSINESS_CODE
                 , UOM_CONVERSION_VALUE 
              FROM EDW.W_CM_TB_FG_ITEM_M 
             WHERE LIQUOR_CODE IN ('10', '20')
               AND BUSINESS_CODE IN ('1', '2')
               AND ITEM_TYPE = 'FG'
               AND BRAND_CODE != '27'
    ) 
    , SALES_TBL AS (                                                                -- 월별, 사업별  당월 및 년 누계 판매량
            SELECT A.SALES_YYYYMM
                 , A.LIQUOR_CODE
                 , SUM(A.SALES_QTY_CD_ACCU) AS SALES_QTY_CD_ACCU_SUM 
                 , SUM(A.SALES_QTY_CD)      AS SALES_QTY_CD_SUM
              FROM EDW.M_OM_TB_SALE_ITEM_MONTH_F    A
                 , ITEM_TBL                         B
                 , SITE_TBL                         C 
             WHERE A.OU_CODE = 'HJ0' 
               AND A.SALES_YYYYMM LIKE '2021' || '%'
               AND A.LIQUOR_CODE IN ('10', '20')
               AND A.BUSINESS_CODE IN ('1', '2')
               AND A.ITEM_CODE = B.ITEM_CODE
               AND A.LIQUOR_CODE = B.LIQUOR_CODE
               AND A.BUSINESS_CODE = B.BUSINESS_CODE
               AND A.SITE_CODE = C.SITE_CODE
               AND A.LIQUOR_CODE = C.LIQUOR_CODE
               AND A.BUSINESS_CODE = C.BUSINESS_CODE
             GROUP BY A.SALES_YYYYMM, A.LIQUOR_CODE
    ) 
    , SALES_PLAN_TBL AS (                                                           -- 월, 사이트, 아이템, 사업 별 판매목표
            SELECT A.PERIOD_YYYYMM_CODE AS SALES_YYYYMM
                 , A.SITE_CODE
                 , A.ITEM_CODE
                 , A.LIQUOR_CODE
                 , A.SALES_PLAN_QTY
--                 , SALES_PLAN_QTY * UOM_CONVERSION_VALUE AS SALES_PLAN_QTY
              FROM W_OM_TB_SALE_RESULT_MM_F A
                 , ITEM_TBL                 B
                 , SITE_TBL                 C 
             WHERE A.PERIOD_YYYYMM_CODE BETWEEN TO_CHAR(TO_NUMBER('2021') - 1) ||  '0' ||   TO_CHAR(TO_NUMBER('06') + 1) AND '202106'
               AND A.LIQUOR_CODE IN ('10', '20')
               AND A.ITEM_CODE = B.ITEM_CODE
               AND A.LIQUOR_CODE = B.LIQUOR_CODE
               AND A.SITE_CODE = C.SITE_CODE
               AND A.LIQUOR_CODE = C.LIQUOR_CODE
    )
--    , UNION_TBL AS (
            SELECT A.SALES_YYYYMM
                 , (SELECT MAX(SALES_YYYYMM) FROM EDW.M_OM_TB_SALE_ITEM_MONTH_F WHERE SALES_YYYYMM    <![CDATA[ <= ]]>    '202106') AS MAX_SALES_YYYYMM
                 , A.ITEM_CODE
                 , MAX(A.SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
                 , MAX(A.SALES_QTY_CD_SUM) AS SALES_QTY_CD_SUM
                 , SUM(NVL(A.PLAN_QTY_CM_ACCU, 0)) AS PLAN_QTY_CM_ACCU                                                                                          -- 년당월목표누계판매량 (경영목표)
                 , SUM(NVL(A.SALES_QTY_CD_ACCU, 0)) AS SALES_QTY_CD_ACCU                                                                                        -- 년누계판매량 (판매실적)
                 , SUM(NVL(A.SALES_QTY_BYM_ACCU, 0)) AS SALES_QTY_BYM_ACCU                                                                                      -- 전년동월누계판매량 (전년동기)
                 , SUM(NVL(A.SALES_VARIATION_BYY_ACCU, 0)) AS SALES_VARIATION_BYY_ACCU                                                                          -- (전년대비증감)
                 , SUM(NVL(A.DIFF_PER_PLAN_ACCU, 0)) AS DIFF_PER_PLAN_ACCU                                                                                      -- (목표대비차이)

                 , SUM(NVL(A.PLAN_QTY, 0)) AS PLAN_QTY                                                                                                          -- 당월목표량(경영목표)
                 , SUM(NVL(A.SALES_PLAN_QTY, 0)) AS SALES_PLAN_QTY                                                                                              -- (판매계획)
                 , SUM(NVL(A.SALES_QTY_CD, 0)) AS SALES_QTY_CD                                                                                                  -- 당월판매량(판매실적)
                 , SUM(NVL(A.SALES_QTY_BYM, 0)) AS SALES_QTY_BYM                                                                                                -- 전년동월판매량(전년동기)
                 , SUM(NVL(A.SALES_VARIATION_BYY, 0)) AS SALES_VARIATION_BYY                                                                                    -- (전년대비증감)
                 , SUM(NVL(A.DIFF_PER_PLAN, 0)) AS DIFF_PER_PLAN                                                                                                -- (목표대비차이)
              FROM (
                    -- PLAN
                    SELECT A.SALES_YYYYMM
                         , A.LIQUOR_CODE
                         , A.SITE_CODE
                         , A.ITEM_CODE
                         , MAX(C.SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
                         , MAX(C.SALES_QTY_CD_SUM) AS SALES_QTY_CD_SUM
                         , NULL AS PLAN_QTY_CM_ACCU                                                                                        -- 년당월목표누계판매량 (경영목표)
                         , NULL AS SALES_QTY_CD_ACCU                                                                                      -- 년누계판매량 (판매실적)
                         , NULL AS SALES_QTY_BYM_ACCU                                                                                    -- 전년동월누계판매량 (전년동기)
                         , NULL AS SALES_VARIATION_BYY_ACCU                                                          -- (전년대비증감)
                         , NULL AS DIFF_PER_PLAN_ACCU                                                             -- (목표대비차이)
                         , NULL AS PLAN_QTY                                                                                                        -- 당월목표량(경영목표)
                         , SUM(SALES_PLAN_QTY) AS SALES_PLAN_QTY                                                                                            -- (판매계획)
                         , NULL AS SALES_QTY_CD                                                                                                -- 당월판매량(판매실적)
                         , NULL AS SALES_QTY_BYM                                                                                              -- 전년동월판매량(전년동기)
                         , NULL AS SALES_VARIATION_BYY                                                                    -- (전년대비증감)
                         , NULL AS DIFF_PER_PLAN                                                                               -- (목표대비차이)
                      FROM SALES_PLAN_TBL A
--                         , SITE_TBL B
                         , SALES_TBL C
                     WHERE 1 = 1
--                       AND A.SITE_CODE = B.SITE_CODE
                       AND A.SALES_YYYYMM = C.SALES_YYYYMM
                       AND A.LIQUOR_CODE = C.LIQUOR_CODE
                     GROUP BY A.SALES_YYYYMM, A.LIQUOR_CODE, A.ITEM_CODE, A.SITE_CODE
                     UNION ALL
                    -- DATA
                    SELECT A.SALES_YYYYMM
                         , A.LIQUOR_CODE
                         , A.SITE_CODE
                         , A.ITEM_CODE
                         , MAX(C.SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
                         , MAX(C.SALES_QTY_CD_SUM) AS SALES_QTY_CD_SUM
                         , SUM(A.PLAN_QTY_CM_ACCU) AS PLAN_QTY_CM_ACCU                                                                                        -- 년당월목표누계판매량 (경영목표)
                         , SUM(A.SALES_QTY_CD_ACCU) AS SALES_QTY_CD_ACCU                                                                                      -- 년누계판매량 (판매실적)
                         , SUM(A.SALES_QTY_BYM_ACCU) AS SALES_QTY_BYM_ACCU                                                                                    -- 전년동월누계판매량 (전년동기)
                         , SUM(A.SALES_QTY_CD_ACCU) - SUM(A.SALES_QTY_BYM_ACCU) AS SALES_VARIATION_BYY_ACCU                                                          -- (전년대비증감)
                         , SUM(A.PLAN_QTY_CM_ACCU) - SUM(A.SALES_QTY_CD_ACCU) AS DIFF_PER_PLAN_ACCU                                                             -- (목표대비차이)
                         , SUM(A.PLAN_QTY) AS PLAN_QTY                                                                                                        -- 당월목표량(경영목표)
                         , NULL AS SALES_PLAN_QTY                                                                                            -- (판매계획)
                         , SUM(A.SALES_QTY_CD) AS SALES_QTY_CD                                                                                                -- 당월판매량(판매실적)
                         , SUM(A.SALES_QTY_BYM) AS SALES_QTY_BYM                                                                                              -- 전년동월판매량(전년동기)
                         , SUM(A.SALES_QTY_CD) - SUM(A.SALES_QTY_BYM) AS SALES_VARIATION_BYY                                                                    -- (전년대비증감)
                         , SUM(A.PLAN_QTY) - SUM(A.SALES_QTY_CD) AS DIFF_PER_PLAN                                                                               -- (목표대비차이)
                      FROM EDW.M_OM_TB_SALE_ITEM_MONTH_F A 
                         , SITE_TBL B
                         , SALES_TBL C
                         , ITEM_TBL D
                     WHERE 1 = 1
                       AND A.OU_CODE = 'HJ0'
                       AND A.SALES_YYYYMM BETWEEN TO_CHAR(TO_NUMBER('2021') - 1) ||  '0' ||   TO_CHAR(TO_NUMBER('06') + 1) AND '202106'
                       AND A.LIQUOR_CODE IN ('10', '20')
                       AND A.BUSINESS_CODE IN ('1', '2')
                       AND A.SITE_CODE = B.SITE_CODE
                       AND A.BUSINESS_CODE = B.BUSINESS_CODE
                       AND A.LIQUOR_CODE = B.LIQUOR_CODE
                       AND A.SALES_YYYYMM = C.SALES_YYYYMM
                       AND A.LIQUOR_CODE = C.LIQUOR_CODE
                       AND A.ITEM_CODE = D.ITEM_CODE
                       AND A.BUSINESS_CODE = D.BUSINESS_CODE
                       AND A.LIQUOR_CODE = D.LIQUOR_CODE
                     GROUP BY A.SALES_YYYYMM, A.LIQUOR_CODE, A.ITEM_CODE, A.SITE_CODE
                 ) A
--                 , EDW.W_CM_TB_FG_ITEM_M     B
--             WHERE A.ITEM_CODE = B.ITEM_CODE
--               AND B.ITEM_TYPE   = 'FG'
             GROUP BY A.ITEM_CODE, A.SALES_YYYYMM
    )    
    , TBL AS (
        SELECT CASE WHEN C.LVL = 1 THEN 'LI' || A.LIQUOR_CODE
                    WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE
                    WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE
                    WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE
                    WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE || '|' || A.ITEM_CODE
               END              AS PK_PATH
             , CASE WHEN C.LVL = 1 THEN 'NULL'
                    WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE 
                    WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE 
                    WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE 
                    WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE 
                    WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE 
               END              AS HRNK_PK_PATH 
             , CASE WHEN C.LVL = 1 THEN A.LIQUOR_CODE
                    WHEN C.LVL = 2 THEN A.BRAND_SORT_ORDER
                    WHEN C.LVL = 3 THEN A.USAGE_SORT_ORDER
                    WHEN C.LVL = 4 THEN A.VESSEL_SORT_ORDER
                    WHEN C.LVL = 5 THEN A.VOLUME_SORT_ORDER || A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN A.ITEM_CODE
               END              AS SORT_ORDER
             , CASE WHEN C.LVL = 1 THEN DECODE(A.LIQUOR_CODE, '10', '맥주', '20', '소주')
                    WHEN C.LVL = 2 THEN A.BRAND_NAME
                    WHEN C.LVL = 3 THEN A.USAGE_NAME
                    WHEN C.LVL = 4 THEN A.VESSEL_SORT
                    WHEN C.LVL = 5 THEN A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN A.DESCRIPTION
               END              AS DESCRIPTION
             , MAX(SALES_QTY_CD_ACCU_SUM) AS SALES_QTY_CD_ACCU_SUM
             , MAX(SALES_QTY_CD_SUM)      AS SALES_QTY_CD_SUM

             , SUM(DECODE(SALES_YYYYMM, '2020'||'07', PLAN_QTY, 0)) AS COL20200701                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_PLAN_QTY, 0)) AS COL20200702                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_CD, 0)) AS COL20200703                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20200704                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20200705     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_BYM, 0)) AS COL20200706                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_BYM, 0)) AS COL20200707                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_BYM, 0)))
                    , 4) AS COL20200708                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2020'||'07', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_CD, 0)) AS COL20200709                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'07', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'07', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'07', PLAN_QTY, 0)))
                    , 4) AS COL20200710                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2020'||'08', PLAN_QTY, 0)) AS COL20200801                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_PLAN_QTY, 0)) AS COL20200802                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_CD, 0)) AS COL20200803                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20200804                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20200805     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_BYM, 0)) AS COL20200806                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_BYM, 0)) AS COL20200807                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_BYM, 0)))
                    , 4) AS COL20200808                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2020'||'08', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_CD, 0)) AS COL20200809                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'08', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'08', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'08', PLAN_QTY, 0)))
                    , 4) AS COL20200810                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2020'||'09', PLAN_QTY, 0)) AS COL20200901                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_PLAN_QTY, 0)) AS COL20200902                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_CD, 0)) AS COL20200903                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20200904                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20200905     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_BYM, 0)) AS COL20200906                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_BYM, 0)) AS COL20200907                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_BYM, 0)))
                    , 4) AS COL20200908                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2020'||'09', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_CD, 0)) AS COL20200909                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'09', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'09', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'09', PLAN_QTY, 0)))
                    , 4) AS COL20200910                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2020'||'10', PLAN_QTY, 0)) AS COL20201001                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_PLAN_QTY, 0)) AS COL20201002                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_CD, 0)) AS COL20201003                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20201004                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20201005     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_BYM, 0)) AS COL20201006                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_BYM, 0)) AS COL20201007                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_BYM, 0)))
                    , 4) AS COL20201008                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2020'||'10', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_CD, 0)) AS COL20201009                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'10', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'10', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'10', PLAN_QTY, 0)))
                    , 4) AS COL20201010                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2020'||'11', PLAN_QTY, 0)) AS COL20201101                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_PLAN_QTY, 0)) AS COL20201102                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_CD, 0)) AS COL20201103                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20201104                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20201105     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_BYM, 0)) AS COL20201106                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_BYM, 0)) AS COL20201107                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_BYM, 0)))
                    , 4) AS COL20201108                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2020'||'11', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_CD, 0)) AS COL20201109                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'11', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'11', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'11', PLAN_QTY, 0)))
                    , 4) AS COL20201110                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2020'||'12', PLAN_QTY, 0)) AS COL20201201                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_PLAN_QTY, 0)) AS COL20201202                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_CD, 0)) AS COL20201203                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20201204                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20201205     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_BYM, 0)) AS COL20201206                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_BYM, 0)) AS COL20201207                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_BYM, 0)))
                    , 4) AS COL20201208                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2020'||'12', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_CD, 0)) AS COL20201209                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2020'||'12', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2020'||'12', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2020'||'12', PLAN_QTY, 0)))
                    , 4) AS COL20201210                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, PLAN_QTY_CM_ACCU, 0))         AS COL20210001                                                         -- 년당월목표누계판매량 (경영목표)    

             , SUM(SALES_PLAN_QTY) AS COL20210002                                                                                                                        -- 년 누계(판매계획)

             , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0))        AS COL20210003                                                        -- 년누계판매량 (판매실적)

             , ROUND(DECODE(SUM(SALES_PLAN_QTY), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) / SUM(SALES_PLAN_QTY))
                    , 4) AS COL20210004                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) / MAX(SALES_QTY_CD_ACCU_SUM), 4) AS COL20210005                           -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0))       AS COL20210006                                                       -- 전년동월누계판매량 (전년동기)

             , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_VARIATION_BYY_ACCU, 0)) AS COL20210007                                                         -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) - SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_BYM_ACCU, 0)))
                    , 4) AS COL20210008                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, DIFF_PER_PLAN_ACCU, 0))       AS COL20210009                                                         -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, PLAN_QTY_CM_ACCU, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, SALES_QTY_CD_ACCU, 0)) / SUM(DECODE(SALES_YYYYMM, MAX_SALES_YYYYMM, PLAN_QTY_CM_ACCU, 0)))
                    , 4) AS COL20210010                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2021'||'01', PLAN_QTY, 0)) AS COL20210101                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_PLAN_QTY, 0)) AS COL20210102                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_CD, 0)) AS COL20210103                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20210104                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20210105     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_BYM, 0)) AS COL20210106                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_BYM, 0)) AS COL20210107                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_BYM, 0)))
                    , 4) AS COL20210108                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2021'||'01', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_CD, 0)) AS COL20210109                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'01', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'01', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'01', PLAN_QTY, 0)))
                    , 4) AS COL20210110                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2021'||'02', PLAN_QTY, 0)) AS COL20210201                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_PLAN_QTY, 0)) AS COL20210202                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_CD, 0)) AS COL20210203                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20210204                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20210205     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_BYM, 0)) AS COL20210206                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_BYM, 0)) AS COL20210207                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_BYM, 0)))
                    , 4) AS COL20210208                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2021'||'02', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_CD, 0)) AS COL20210209                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'02', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'02', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'02', PLAN_QTY, 0)))
                    , 4) AS COL20210210                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2021'||'03', PLAN_QTY, 0)) AS COL20210301                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_PLAN_QTY, 0)) AS COL20210302                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_CD, 0)) AS COL20210303                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20210304                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20210305     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_BYM, 0)) AS COL20210306                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_BYM, 0)) AS COL20210307                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_BYM, 0)))
                    , 4) AS COL20210308                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2021'||'03', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_CD, 0)) AS COL20210309                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'03', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'03', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'03', PLAN_QTY, 0)))
                    , 4) AS COL20210310                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2021'||'04', PLAN_QTY, 0)) AS COL20210401                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_PLAN_QTY, 0)) AS COL20210402                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_CD, 0)) AS COL20210403                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20210404                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20210405     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_BYM, 0)) AS COL20210406                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_BYM, 0)) AS COL20210407                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_BYM, 0)))
                    , 4) AS COL20210408                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2021'||'04', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_CD, 0)) AS COL20210409                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'04', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'04', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'04', PLAN_QTY, 0)))
                    , 4) AS COL20210410                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2021'||'05', PLAN_QTY, 0)) AS COL20210501                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_PLAN_QTY, 0)) AS COL20210502                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_CD, 0)) AS COL20210503                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20210504                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20210505     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_BYM, 0)) AS COL20210506                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_BYM, 0)) AS COL20210507                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_BYM, 0)))
                    , 4) AS COL20210508                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2021'||'05', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_CD, 0)) AS COL20210509                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'05', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'05', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'05', PLAN_QTY, 0)))
                    , 4) AS COL20210510                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

             , SUM(DECODE(SALES_YYYYMM, '2021'||'06', PLAN_QTY, 0)) AS COL20210601                                      -- 당월목표량(경영목표)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_PLAN_QTY, 0)) AS COL20210602                                -- 당월 (판매계획)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_CD, 0)) AS COL20210603                                  -- 당월판매량(판매실적)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_PLAN_QTY, 0)))
                    , 4) AS COL20210604                                                                                                                                    -- (계획 대비 달성률) 실적 / 계획

             , ROUND(SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_CD, 0)) / MAX(SALES_QTY_CD_SUM), 4) AS COL20210605     -- (판매구성비)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_BYM, 0)) AS COL20210606                                 -- 전년동월판매량(전년동기)

             , SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_CD, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_BYM, 0)) AS COL20210607                                   -- (전년대비증감)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_BYM, 0)), 0, 0
                           , (SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_CD, 0)) - SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_BYM, 0))) 
                           / SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_BYM, 0)))
                    , 4) AS COL20210608                                                                                                                                      -- (증감률)                 

             , SUM(DECODE(SALES_YYYYMM, '2021'||'06', PLAN_QTY, 0)) 
             - SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_CD, 0)) AS COL20210609                                  -- (목표대비차이)

             , ROUND(DECODE(SUM(DECODE(SALES_YYYYMM, '2021'||'06', PLAN_QTY, 0)), 0, 0
                           , SUM(DECODE(SALES_YYYYMM, '2021'||'06', SALES_QTY_CD, 0)) / SUM(DECODE(SALES_YYYYMM, '2021'||'06', PLAN_QTY, 0)))
                    , 4) AS COL20210610                                                                                                                                    -- (목표 대비 달성률) 실적 / 목표

          FROM UNION_TBL B
    INNER JOIN EDW.W_CM_TB_FG_ITEM_M A
            ON A.ITEM_CODE = B.ITEM_CODE
    CROSS JOIN (
                    SELECT 1 AS LVL FROM DUAL UNION ALL
                    SELECT 2 AS LVL FROM DUAL UNION ALL
                    SELECT 3 AS LVL FROM DUAL UNION ALL
                    SELECT 4 AS LVL FROM DUAL UNION ALL
                    SELECT 5 AS LVL FROM DUAL UNION ALL
                    SELECT 6 AS LVL FROM DUAL
               )                         C
         WHERE 1 = 1
         GROUP BY 
               CASE WHEN C.LVL = 1 THEN 'LI' || A.LIQUOR_CODE
                    WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE
                    WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE
                    WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE
                    WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE || '|' || A.ITEM_CODE
               END              
             , CASE WHEN C.LVL = 1 THEN 'NULL'
                    WHEN C.LVL = 2 THEN 'LI' || A.LIQUOR_CODE 
                    WHEN C.LVL = 3 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE 
                    WHEN C.LVL = 4 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE 
                    WHEN C.LVL = 5 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE 
                    WHEN C.LVL = 6 THEN 'LI' || A.LIQUOR_CODE || '|' || 'BR' || A.BRAND_CODE || '|' || 'US' || A.USAGE_CODE || '|' || 'VE' || A.VESSEL_CODE || '|' || 'VO' || A.VOLUME_VALUE 
               END              
             , CASE WHEN C.LVL = 1 THEN A.LIQUOR_CODE
                    WHEN C.LVL = 2 THEN A.BRAND_SORT_ORDER
                    WHEN C.LVL = 3 THEN A.USAGE_SORT_ORDER
                    WHEN C.LVL = 4 THEN A.VESSEL_SORT_ORDER
                    WHEN C.LVL = 5 THEN A.VOLUME_SORT_ORDER || A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN A.ITEM_CODE
               END              
             , CASE WHEN C.LVL = 1 THEN DECODE(A.LIQUOR_CODE, '10', '맥주', '20', '소주')
                    WHEN C.LVL = 2 THEN A.BRAND_NAME
                    WHEN C.LVL = 3 THEN A.USAGE_NAME
                    WHEN C.LVL = 4 THEN A.VESSEL_SORT
                    WHEN C.LVL = 5 THEN A.VOLUME_VALUE
                    WHEN C.LVL = 6 THEN A.DESCRIPTION
               END             
    )
        SELECT LEVEL AS DEPTH
             , DESCRIPTION
             , SORT_ORDER
             , PK_PATH
             , HRNK_PK_PATH
             , CONNECT_BY_ISLEAF IS_LEAF

             , COL20200701

             , COL20200702

             , COL20200703

             , COL20200704

             , COL20200705

             , COL20200706

             , COL20200707

             , COL20200708

             , COL20200709

             , COL20200710

             , COL20200801

             , COL20200802

             , COL20200803

             , COL20200804

             , COL20200805

             , COL20200806

             , COL20200807

             , COL20200808

             , COL20200809

             , COL20200810

             , COL20200901

             , COL20200902

             , COL20200903

             , COL20200904

             , COL20200905

             , COL20200906

             , COL20200907

             , COL20200908

             , COL20200909

             , COL20200910

             , COL20201001

             , COL20201002

             , COL20201003

             , COL20201004

             , COL20201005

             , COL20201006

             , COL20201007

             , COL20201008

             , COL20201009

             , COL20201010

             , COL20201101

             , COL20201102

             , COL20201103

             , COL20201104

             , COL20201105

             , COL20201106

             , COL20201107

             , COL20201108

             , COL20201109

             , COL20201110

             , COL20201201

             , COL20201202

             , COL20201203

             , COL20201204

             , COL20201205

             , COL20201206

             , COL20201207

             , COL20201208

             , COL20201209

             , COL20201210

             , COL20210001

             , COL20210002

             , COL20210003

             , COL20210004

             , COL20210005

             , COL20210006

             , COL20210007

             , COL20210008

             , COL20210009

             , COL20210010

             , COL20210101

             , COL20210102

             , COL20210103

             , COL20210104

             , COL20210105

             , COL20210106

             , COL20210107

             , COL20210108

             , COL20210109

             , COL20210110

             , COL20210201

             , COL20210202

             , COL20210203

             , COL20210204

             , COL20210205

             , COL20210206

             , COL20210207

             , COL20210208

             , COL20210209

             , COL20210210

             , COL20210301

             , COL20210302

             , COL20210303

             , COL20210304

             , COL20210305

             , COL20210306

             , COL20210307

             , COL20210308

             , COL20210309

             , COL20210310

             , COL20210401

             , COL20210402

             , COL20210403

             , COL20210404

             , COL20210405

             , COL20210406

             , COL20210407

             , COL20210408

             , COL20210409

             , COL20210410

             , COL20210501

             , COL20210502

             , COL20210503

             , COL20210504

             , COL20210505

             , COL20210506

             , COL20210507

             , COL20210508

             , COL20210509

             , COL20210510

             , COL20210601

             , COL20210602

             , COL20210603

             , COL20210604

             , COL20210605

             , COL20210606

             , COL20210607

             , COL20210608

             , COL20210609

             , COL20210610

          FROM TBL A
         START WITH HRNK_PK_PATH = 'NULL'
       CONNECT BY NOCYCLE PRIOR PK_PATH = HRNK_PK_PATH
         ORDER SIBLINGS BY SORT_ORDER

	</select>
	
	
	
	
	

</mapper>